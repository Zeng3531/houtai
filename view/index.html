<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>示例演示</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- 注意：项目正式环境请勿引用该地址 -->
  <link rel="stylesheet" href="/layui.css">
  <link rel="stylesheet" href="/nprogress.css">
</head>

<body>
  <div class="inhtml">
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header">
      <div class="layui-logo layui-hide-xs layui-bg-black">后台管理系统</div>
      <!-- 头部区域（可配合layui 已有的水平导航） -->
      <ul class="layui-nav layui-layout-left">
        <!-- 移动端显示 -->
        <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
          <i class="layui-icon layui-icon-spread-left"></i>
        </li>

        <li class="layui-nav-item layui-hide-xs"><a href="">nav 1</a></li>

        <li class="layui-nav-item layui-hide-xs"><a href="">nav 2</a></li>
        <li class="layui-nav-item layui-hide-xs"><a href="">nav 3</a></li>
        <li class="layui-nav-item">
          <a href="javascript:;">nav groups</a>
          <dl class="layui-nav-child">
            <dd><a href="">menu 11</a></dd>
            <dd><a href="">menu 22</a></dd>
            <dd><a href="">menu 33</a></dd>
          </dl>
        </li>

    <div id="thename" style="position:absolute;left:1062px;width: 70px;top:20px;">用户名</div>
      </ul>
      <ul class="layui-nav layui-layout-right">
        <li class="layui-nav-item layui-hide layui-show-md-inline-block">
          <div class="layui-upload-list">
        
            <img src=""  class="layui-upload-img" style="width:50px;margin-top: -21px;border-radius: 50%;height: 44px;" id="demo1">
            <input type="button" class="layui-btn" id="test1" value="上传头像" style="margin-bottom: 20px;"/>
            
            <p id="demoText"></p>
          </div>

        </li>
      
      </ul>
    </div>

    <div class="layui-side layui-bg-black">
      <div class="layui-side-scroll">
        <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
        <ul class="layui-nav layui-nav-tree" lay-filter="test">
          <li class="layui-nav-item layui-nav-itemed">
            <a class="" href="javascript:;">选项框</a>
            <dl class="layui-nav-child">
              <dd class="index"><a href="/index">主表单内容</a></dd>
              <dd><a href="/duohang">分页表单内容</a></dd>
              <dd><a href="/increase">上传新书</a></dd>
              <dd id="recycling"><a href="/recycling">回收站</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item">
            <a href="javascript:;">menu group 2</a>
            <dl class="layui-nav-child">
              <dd><a href="javascript:;">list 1</a></dd>
              <dd><a href="javascript:;">list 2</a></dd>
              <dd><a href="">超链接</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item"><a href="javascript:;">click menu item</a></li>
          <li class="layui-nav-item"><a href="">the links</a></li>
        </ul>
      </div>
    </div>

    <div class="layui-body">
      <!-- 内容主体区域 -->
      <div style="padding: 15px;">
        内容主体区域


        <br><br>

        <blockquote class="layui-elem-quote layui-text">

        </blockquote>

        <br><br><br>

        <div class="layui-card layui-panel">
          <div class="layui-card-header">
            下面是充数内容，为的是出现滚动条
          </div>
          <div id="layuibtn" class="layui-card-body">

            <table class="layui-table" lay-data="{height: 308, url:'http://127.0.0.1:3300/book'}"
              lay-filter="demoEvent">
              <thead>
                <tr fuzhiid="{field:'id'}" lay-data="{field:'id'}">
                  <th lay-data="{field:'id', width:80}">ID</th>
                  <th lay-data="{field:'bookname', width:80}">书名</th>
                  <th lay-data="{field:'numGB', width:'50%', event: 'setSign', style:'cursor: pointer;'}">占流量</th>
                  <th lay-data="{field:'title'}">类型</th>
                  <th lay-data="{field:'score', templet:'#toolbarDemo'} ">操作</th>
                  <th lay-data="{field:'bookimg',  templet:'#toolbarDemos'} ">书面</th>
                </tr>
              </thead>
            </table>

          </div>
        </div>
        <br><br>


      </div>
    </div>

    <div class="layui-footer">
      <!-- 底部固定区域 -->
      底部固定区域
    </div>
  </div>

  <script type="text/html" id="toolbarDemo">
  <div class="layui-btn-container">
    <button class="layui-btn layui-btn-sm">下架</button>
  </div>
</script>
  <script type="text/html" id="toolbarDemos">
  <div class="layui-btn-container">
    <img src="https://t8.baidu.com/it/u=1252071618,2839278199&fm=218&app=126&size=f242,150&n=0&f=JPEG&fmt=auto?s=BF88792351C164F21F5D90C70100E0B3&sec=1657558800&t=2133be47823726ca8ca03835b137346d" class="layui-nav-img layui-img-sm">
  </div>
</script>


</div>
</body>
<script src="/layui.js"></script>
<script src="/nprogress.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/js-cookie/3.0.1/js.cookie.js"></script>
<script>
  
  if(Cookies.get('portrait')){
    demo1.src = Cookies.get('portrait')
  }
  if(Cookies.get('thename')){
    thename.innerText = Cookies.get('thename')
  }
  // let btn = document.getElementById('btn')
  // console.log(btn);
  layuibtn.onclick = function (e) {
 
    if (e.target.nodeName == 'BUTTON') {
      NProgress.start()
      let numid = e.target.parentElement.parentElement.parentElement.parentElement.childNodes[0].childNodes[0].innerText

      let deleteid = e.target.parentElement.parentElement.parentElement.parentElement.getAttribute('data-index')

      e.target.parentElement.parentElement.parentElement.parentElement.remove()
      fetch('http://127.0.0.1:3300/delete', {
        method: 'POST', // *GET, POST, PUT, DELETE, etc.
        mode: 'cors', // no-cors, *cors, same-origin
        cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
        credentials: 'same-origin', // include, *same-origin, omit
        headers: {
          'Content-Type': 'application/json'
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: JSON.stringify({ name: numid })

      }).then(res => {
        res.json().then(res => { 
          res
          NProgress.done()
          ; })
      })
    }
  }
  // btn.addEventListener('click',function(e){
  //   console.log(111);
  // })
  //JS 
  layui.use(['element', 'layer', 'util'], function () {
    var element = layui.element
      , layer = layui.layer
      , util = layui.util
      , $ = layui.$;


    //头部事件
    util.event('lay-header-event', {
      //左侧菜单事件
      menuLeft: function (othis) {
        layer.msg('展开左侧菜单的操作', { icon: 0 });
      }

      , menuRight: function () {
        layer.open({
          type: 1
          , page: true //开启分页
          , title: '更多'
          , content: '<div style="padding: 15px;">处理右侧面板的操作</div>'
          , area: ['260px', '100%']
          , offset: 'rt' //右上角
          , anim: 5
          , shadeClose: true
          , scrollbar: false
        });
      }
    });

  });

  layui.use(['upload', 'element', 'layer'], function(){
  var $ = layui.jquery
  ,upload = layui.upload
  ,element = layui.element
  ,layer = layui.layer;
  
  //常规使用 - 普通图片上传
  var uploadInst = upload.render({
    elem: '#test1'
    ,url: '/avatar' //此处用的是第三方的 http 请求演示，实际使用时改成您自己的上传接口即可。
    ,before: function(obj){
      //预读本地文件示例，不支持ie8
      obj.preview(function(index, file, result){

        $('#demo1').attr('src', result); //图片链接（base64）
      });
      element.progress('demo', '0%'); //进度条复位
      layer.msg('上传中', {icon: 16, time: 0});
    }
    ,done: function(res){
      //如果上传失败
      if(res.code > 0){
        return layer.msg('上传失败');
      }
      //上传成功的一些操作
      //……
      $('#demoText').html(''); //置空上传失败的状态
    }
    ,error: function(){
      //演示失败状态，并实现重传
      var demoText = $('#demoText');
      demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
      demoText.find('.demo-reload').on('click', function(){
        uploadInst.upload();
      });
    }
    //进度条
    ,progress: function(n, elem, e){
      element.progress('demo', n + '%'); //可配合 layui 进度条元素使用
      if(n == 100){
        layer.msg('上传完毕', {icon: 1});
      }
    }
  });
  })

  let inhtml = document.querySelector('.inhtml')
  recycling.onclick = function(){
    fetch('http://127.0.0.1:3300/recycling').then(data=>{
      return data.text();
    }).then(res=>{ inhtml.innerHTML = res })
  }

</script>

</html>